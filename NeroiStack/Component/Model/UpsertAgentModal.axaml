<UserControl
	x:Class="NeroiStack.Component.Model.UpsertAgentModal"
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="clr-namespace:NeroiStack.ViewModels"
	d:DesignHeight="600"
	d:DesignWidth="500"
	mc:Ignorable="d">

	<Border
		Width="500"
		HorizontalAlignment="Center"
		VerticalAlignment="Center"
		Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
		BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
		BorderThickness="1"
		CornerRadius="8">
		<Grid Margin="20" RowDefinitions="Auto, *, Auto">
			<SelectableTextBlock
				Grid.Row="0"
				Margin="0,0,0,15"
				FontSize="20"
				FontWeight="Bold"
				Text="{Binding ModalTitle}" />

			<ScrollViewer Grid.Row="1" MaxHeight="500">
				<StackPanel Spacing="10">
					<Grid ColumnDefinitions="*, Auto">
						<StackPanel>
							<SelectableTextBlock Text="Name" />
							<TextBox Text="{Binding CurrentAgent.Name}" />
						</StackPanel>
					</Grid>

					<SelectableTextBlock Text="Description" />
					<TextBox
						Height="60"
						AcceptsReturn="True"
						Text="{Binding CurrentAgent.Description}" />

					<SelectableTextBlock Text="Kernel" />
					<TextBox Text="{Binding CurrentAgent.Kernel}" />

					<SelectableTextBlock Text="Instructions" />
					<TextBox
						Height="120"
						AcceptsReturn="True"
						Text="{Binding CurrentAgent.Instructions}" />

					<!--  Advanced Settings  -->
					<Expander
						Margin="0,10,0,0"
						HorizontalAlignment="Stretch"
						Header="Advanced Settings">
						<StackPanel Spacing="10">
							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Temperature (0-2)" />
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="0"
										Value="{Binding CurrentAgent.Temperature}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Top P (0-1)" />
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.00"
										Increment="0.05"
										Maximum="1"
										Minimum="0"
										Value="{Binding CurrentAgent.TopP}" />
								</StackPanel>
							</Grid>

							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Max Tokens" />
									<NumericUpDown
										HorizontalAlignment="Stretch"
										Increment="128"
										Maximum="128000"
										Minimum="1"
										Value="{Binding CurrentAgent.MaxTokens}" />
								</StackPanel>
							</Grid>

							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Presence Penalty" />
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="-2"
										Value="{Binding CurrentAgent.PresencePenalty}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Frequency Penalty" />
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="-2"
										Value="{Binding CurrentAgent.FrequencyPenalty}" />
								</StackPanel>
							</Grid>

							<SelectableTextBlock
								FontSize="12"
								Foreground="#AAA"
								Text="Response Format" />
							<TextBox Text="{Binding CurrentAgent.ResponseFormat}" Watermark="e.g. { &quot;type&quot;: &quot;json_object&quot; }" />

							<SelectableTextBlock
								FontSize="12"
								Foreground="#AAA"
								Text="Prompt Template" />
							<TextBox
								Height="80"
								AcceptsReturn="True"
								Text="{Binding CurrentAgent.PromptTemplate}"
								Watermark="Optional custom template..." />
						</StackPanel>
					</Expander>

					<SelectableTextBlock
						Margin="0,10,0,5"
						FontWeight="Bold"
						Text="Plugins" />
					<Border
						Padding="5"
						BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
						BorderThickness="1"
						CornerRadius="4">
						<StackPanel>
							<ItemsControl ItemsSource="{Binding AvailablePlugins}">
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<CheckBox
											Margin="0,2"
											Content="{Binding Name}"
											IsChecked="{Binding IsSelected}" />
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
							<Button
								HorizontalAlignment="Stretch"
								HorizontalContentAlignment="Left"
								Classes="Link"
								Command="{Binding CreatePluginCommand}"
								Content="âž• Create Plugin"
								Foreground="{DynamicResource SystemControlForegroundAccentBrush}" />
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>

			<StackPanel
				Grid.Row="2"
				Margin="0,15,0,0"
				HorizontalAlignment="Right"
				Orientation="Horizontal"
				Spacing="10">
				<Button Command="{Binding CloseModalCommand}" Content="Cancel" />
				<Button
					Classes="accent"
					Command="{Binding SaveCommand}"
					Content="Save" />
			</StackPanel>
		</Grid>
	</Border>
</UserControl>
