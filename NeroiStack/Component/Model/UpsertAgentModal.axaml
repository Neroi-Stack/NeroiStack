<UserControl
	x:Class="NeroiStack.Component.Model.UpsertAgentModal"
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="clr-namespace:NeroiStack.ViewModels"
	d:DesignHeight="600"
	d:DesignWidth="500"
	mc:Ignorable="d">

	<Border
		Width="500"
		HorizontalAlignment="Center"
		VerticalAlignment="Center"
		Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
		BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
		BorderThickness="1"
		CornerRadius="8">
		<Grid Margin="20" RowDefinitions="Auto, *, Auto">
			<SelectableTextBlock
				Grid.Row="0"
				Margin="0,0,0,15"
				FontSize="20"
				FontWeight="Bold"
				Text="{Binding ModalTitle}" />

			<ScrollViewer Grid.Row="1" MaxHeight="500">
				<StackPanel Spacing="10">
					<Grid ColumnDefinitions="*, Auto">
						<StackPanel>
							<SelectableTextBlock Text="Name" />
							<TextBox Text="{Binding CurrentAgent.Name}" />
						</StackPanel>
					</Grid>

					<SelectableTextBlock Text="Description" />
					<TextBox
						Height="60"
						AcceptsReturn="True"
						Text="{Binding CurrentAgent.Description}" />



					<SelectableTextBlock Text="Instructions" />
					<TextBox
						Height="120"
						AcceptsReturn="True"
						Text="{Binding CurrentAgent.Instructions}" />

					<!--  Advanced Settings  -->
					<Expander
						Margin="0,10,0,0"
						HorizontalAlignment="Stretch"
						Header="Advanced Settings"
						IsExpanded="False">
						<StackPanel Spacing="15">
							<StackPanel>
								<SelectableTextBlock FontWeight="Bold" Foreground="Red" Text="* NOT All Model Parameters are Supported" />
							</StackPanel>
							<!-- Row 1: Core Sampling (Temp, TopP) -->
							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Temperature"
										ToolTip.Tip="Controls randomness (0.0 - 2.0). Lower is more deterministic. Supported by: All."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="0"
										Watermark="Default"
										Value="{Binding CurrentAgent.Temperature}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Top P"
										ToolTip.Tip="Nucleus sampling (0.0 - 1.0). Works with Temperature. Supported by: All."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.00"
										Increment="0.05"
										Maximum="1"
										Minimum="0"
										Watermark="Default"
										Value="{Binding CurrentAgent.TopP}" />
								</StackPanel>
							</Grid>

							<!-- Row 2: Advanced Sampling (TopK, Seed) -->
							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Top K"
										ToolTip.Tip="Limits selection to top K tokens. Supported by: Google, Ollama, HuggingFace, Mistral."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										Increment="1"
										Minimum="0"
										Watermark="Default"
										Value="{Binding CurrentAgent.TopK}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Seed" 
										ToolTip.Tip="Integer for reproducible outputs. Supported by: OpenAI, Mistral."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										Increment="1"
										Watermark="Default"
										Value="{Binding CurrentAgent.Seed}" />
								</StackPanel>
							</Grid>

							<!-- Row 3: Length & Constraints -->
							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Max Tokens"
										ToolTip.Tip="Maximum generation length. Supported by: All."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										Increment="128"
										Maximum="128000"
										Minimum="1"
										Watermark="Default"
										Value="{Binding CurrentAgent.MaxTokens}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Stop Sequences" 
										ToolTip.Tip="Sequences where generation stops (semicolon separated). Supported by: All."/>
									<TextBox 
										HorizontalAlignment="Stretch" 
										Text="{Binding CurrentAgent.StopSequences}" 
										Watermark="e.g. USER:;END"/>
								</StackPanel>
							</Grid>

							<!-- Row 4: Penalties (OpenAI mainly) -->
							<Grid ColumnDefinitions="*, 10, *">
								<StackPanel Grid.Column="0">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Presence Penalty"
										ToolTip.Tip="Penalizes new tokens based on presence (-2.0 to 2.0). Supported by: OpenAI, Azure."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="-2"
										Watermark="Default"
										Value="{Binding CurrentAgent.PresencePenalty}" />
								</StackPanel>
								<StackPanel Grid.Column="2">
									<SelectableTextBlock
										FontSize="12"
										Foreground="#AAA"
										Text="Frequency Penalty"
										ToolTip.Tip="Penalizes new tokens based on frequency (-2.0 to 2.0). Supported by: OpenAI, Azure."/>
									<NumericUpDown
										HorizontalAlignment="Stretch"
										FormatString="0.0"
										Increment="0.1"
										Maximum="2"
										Minimum="-2"
										Watermark="Default"
										Value="{Binding CurrentAgent.FrequencyPenalty}" />
								</StackPanel>
							</Grid>

							<!-- Extras -->
							<SelectableTextBlock
								FontSize="12"
								Foreground="#AAA"
								Text="Response Format" />
							<TextBox Text="{Binding CurrentAgent.ResponseFormat}" Watermark="e.g. { &quot;type&quot;: &quot;json_object&quot; }" />

							<SelectableTextBlock
								FontSize="12"
								Foreground="#AAA"
								Text="Prompt Template" />
							<TextBox
								Height="80"
								AcceptsReturn="True"
								Text="{Binding CurrentAgent.PromptTemplate}"
								Watermark="Optional custom template..." />
						</StackPanel>
					</Expander>

					<SelectableTextBlock
						Margin="0,10,0,5"
						FontWeight="Bold"
						Text="Plugins" />
					<Border
						Padding="5"
						BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
						BorderThickness="1"
						CornerRadius="4">
						<StackPanel>
							<ItemsControl ItemsSource="{Binding AvailablePlugins}">
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<CheckBox
											Margin="0,2"
											Content="{Binding Name}"
											IsChecked="{Binding IsSelected}" />
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
							<Button
								HorizontalAlignment="Stretch"
								HorizontalContentAlignment="Left"
								Classes="Link"
								Command="{Binding CreatePluginCommand}"
								Content="âž• Create Plugin"
								Foreground="{DynamicResource SystemControlForegroundAccentBrush}" />
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>

			<StackPanel
				Grid.Row="2"
				Margin="0,15,0,0"
				HorizontalAlignment="Right"
				Orientation="Horizontal"
				Spacing="10">
				<Button Command="{Binding CloseModalCommand}" Content="Cancel" />
				<Button
					Classes="accent"
					Command="{Binding SaveCommand}"
					Content="Save" />
			</StackPanel>
		</Grid>
	</Border>
</UserControl>
