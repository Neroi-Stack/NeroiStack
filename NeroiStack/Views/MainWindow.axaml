<Window
	x:Class="NeroiStack.Views.MainWindow"
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:fluenticons="using:FluentIcons.Avalonia"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:vm="using:NeroiStack.ViewModels"
	Title="NeroiStack"
	d:DesignHeight="450"
	d:DesignWidth="800"
	Icon="/Assets/avalonia-logo.ico"
	mc:Ignorable="d">

	<Design.DataContext>
		<!--
			This only sets the DataContext for the previewer in an IDE,
			to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs)
		-->
		<vm:MainWindowViewModel />
	</Design.DataContext>

	<Window.Styles>
		<Style Selector="Window" />
		<Style Selector="TextBlock">
			<Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
		</Style>
		<Style Selector="SelectableTextBlock">
			<Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
		</Style>
		<Style Selector="Button">
			<Setter Property="Background" Value="Transparent" />
			<Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
			<Setter Property="BorderBrush" Value="Transparent" />
			<Setter Property="Padding" Value="8" />
		</Style>
		<Style Selector="ListBox#SidebarMenu">
			<Setter Property="Background" Value="Transparent" />
			<Setter Property="BorderBrush" Value="Transparent" />
			<Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
		</Style>
		<Style Selector="ListBoxItem">
			<Setter Property="Padding" Value="8" />
			<Setter Property="Margin" Value="0 2" />
			<Setter Property="Template">
				<ControlTemplate>
					<Border Background="{TemplateBinding Background}" CornerRadius="6">
						<ContentPresenter />
					</Border>
				</ControlTemplate>
			</Setter>
		</Style>
	</Window.Styles>

	<Grid ColumnDefinitions="260,*" RowDefinitions="Auto,*,Auto">
		<!--  Sidebar  -->
		<Border
			Grid.RowSpan="3"
			Grid.Column="0"
			Padding="16"
			Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
			<DockPanel LastChildFill="True">
				<!--  Top: logo + quick create  -->
				<StackPanel DockPanel.Dock="Top" Spacing="8">
					<TextBlock
						FontSize="16"
						FontWeight="Bold"
						Text="NeroiStack" />

                    <!-- Fixed Menus -->
                    <StackPanel Margin="0,15,0,0">
    					<TextBlock
    						Margin="4,8"
    						Opacity="0.8"
    						Text="Agents" />
    
    					<ItemsControl ItemsSource="{Binding Menus}">
    						<ItemsControl.ItemTemplate>
    							<DataTemplate>
    								<Button
    									HorizontalAlignment="Stretch"
    									Command="{Binding DataContext.MenuCommand, RelativeSource={RelativeSource AncestorType=Window}}"
    									CommandParameter="{Binding}">
    									<StackPanel Orientation="Horizontal" Spacing="8">
    										<fluenticons:SymbolIcon
    											FontSize="14"
    											IconVariant="Regular"
    											Symbol="{Binding Icon}" />
    										<TextBlock VerticalAlignment="Center" Text="{Binding Text}" />
    									</StackPanel>
    								</Button>
    							</DataTemplate>
    						</ItemsControl.ItemTemplate>
    					</ItemsControl>
    
    					<TextBlock
    						Margin="4,12,0,4"
    						Opacity="0.8"
    						Text="Settings" />
    					<ItemsControl ItemsSource="{Binding SecondaryMenus}">
    						<ItemsControl.ItemTemplate>
    							<DataTemplate>
    								<Button
    									HorizontalAlignment="Stretch"
    									Command="{Binding DataContext.MenuCommand, RelativeSource={RelativeSource AncestorType=Window}}"
    									CommandParameter="{Binding}">
    									<StackPanel Orientation="Horizontal" Spacing="8">
    										<fluenticons:SymbolIcon
    											FontSize="14"
    											IconVariant="Regular"
    											Symbol="{Binding Icon}" />
    										<TextBlock VerticalAlignment="Center" Text="{Binding Text}" />
    									</StackPanel>
    								</Button>
    							</DataTemplate>
    						</ItemsControl.ItemTemplate>
    					</ItemsControl>
                    </StackPanel>
				</StackPanel>

				<!--  Bottom: profile + small actions  -->
				<StackPanel
					Margin="0,8,0,0"
					VerticalAlignment="Bottom"
					DockPanel.Dock="Bottom"
					Orientation="Horizontal"
					Spacing="8">
					<Ellipse
						Width="40"
						Height="40"
						Fill="#2a2c2e" />
					<StackPanel>
						<TextBlock FontWeight="SemiBold" Text="example" />
						<TextBlock
							FontSize="12"
							Opacity="0.7"
							Text="me@example.com" />
					</StackPanel>
				</StackPanel>

                <!-- Middle Scrollable Area -->
				<DockPanel Margin="0,12,0,12">
					<TextBlock
                        DockPanel.Dock="Top"
						Margin="4,12,0,4"
						Opacity="0.8"
						Text="Chat Instances" />
                    
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,12,0">
						<ItemsControl ItemsSource="{Binding ChatMenus}">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
                                    <Grid ColumnDefinitions="*, Auto">
    									<Button
                                            HorizontalContentAlignment="Left"
    										HorizontalAlignment="Stretch"
    										Command="{Binding DataContext.MenuCommand, RelativeSource={RelativeSource AncestorType=Window}}"
    										CommandParameter="{Binding}">
    										<StackPanel Orientation="Horizontal" Spacing="8">
    											<fluenticons:SymbolIcon
    												FontSize="14"
    												IconVariant="Regular"
    												Symbol="{Binding Icon}" />
    											<TextBlock VerticalAlignment="Center" Text="{Binding Text}" />
    										</StackPanel>
    									</Button>
                                        
                                        <Button Grid.Column="1" 
                                                Background="Transparent" 
                                                Margin="4,0,4,0"
                                                Padding="4">
                                            <Button.Flyout>
                                                <MenuFlyout>
                                                     <MenuItem Header="Delete" 
                                                               Command="{Binding DeleteCommand}"
                                                               CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <fluenticons:SymbolIcon Symbol="Delete" Foreground="#FF5555" FontSize="16"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </MenuFlyout>
                                            </Button.Flyout>
                                            <fluenticons:SymbolIcon Symbol="MoreVertical" FontSize="14" Foreground="#888888"/>
                                        </Button>
                                    </Grid>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
                    </ScrollViewer>
				</DockPanel>
			</DockPanel>
		</Border>

		<!--  Header row  -->
		<Border
			Grid.Row="0"
			Grid.Column="1"
			Padding="12"
			Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
			<DockPanel LastChildFill="False">
				<TextBlock
					DockPanel.Dock="Left"
					FontSize="20"
					FontWeight="Bold"
					Text="{Binding Title}" />
				<StackPanel
					HorizontalAlignment="Right"
					DockPanel.Dock="Right"
					Orientation="Horizontal"
					Spacing="8" />
			</DockPanel>
		</Border>

		<!--  Main content area  -->
		<Border
			Grid.Row="1"
			Grid.Column="1"
			Padding="16"
			Background="{DynamicResource SystemControlBackgroundBaseLowBrush}">
			<DockPanel LastChildFill="True">
				<ContentControl Name="PageHost" Content="{Binding CurrentPage}" />
			</DockPanel>
		</Border>

		<!--  Footer  -->
		<Border
			Grid.Row="2"
			Grid.Column="1"
			Padding="10"
			Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
			<DockPanel>
				<TextBlock
					DockPanel.Dock="Left"
					Opacity="0.7"
					Text="NeroiStack. â€” v1.0" />
				<StackPanel
					HorizontalAlignment="Right"
					DockPanel.Dock="Right"
					Orientation="Horizontal">
					<Button Content="GitHub" />
				</StackPanel>
			</DockPanel>
		</Border>
	</Grid>

</Window>
